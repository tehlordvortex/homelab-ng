# yaml-language-server: $schema=https://kubernetesjsonschema.dev/v1.18.1/deployment.json
apiVersion: apps/v1
kind: Deployment
metadata:
  name: haproxy-sango
  namespace: traefik
  labels:
    app.kubernetes.io/name: traefik
    app.kubernetes.io/component: haproxy-sango
spec:
  replicas: 1
  strategy:
    type: Recreate
  selector:
    matchLabels:
      app.kubernetes.io/name: traefik
      app.kubernetes.io/component: haproxy-sango
  template:
    metadata:
      labels:
        app.kubernetes.io/name: traefik
        app.kubernetes.io/component: haproxy-sango
      annotations:
        external-dns.alpha.kubernetes.io/hostname: |
          traefik-sango.sophons.cloud, traefik-sango-star-theta.sophons.cloud
        # enc!
        external-dns.alpha.kubernetes.io/target: ENC[AES256_GCM,data:YXHIQZd/QBzUa2Q4E+Y=,iv:Mpw13GoKAwDvdc5KfeLhC/cwMoNaVpNdUxpe2NuN8gk=,tag:Wf/FgNdrgH6cjC7Wd/Vg/A==,type:str]
    spec:
      tolerations:
        - key: orunmila.sophons.cloud/ase-orun
          operator: Exists
      containers:
        - name: proxy
          image: haproxy:3.2.8-alpine3.22
          args:
            - -f
            - /etc/haproxy/haproxy.cfg
          volumeMounts:
            - mountPath: /etc/haproxy
              name: haproxy
              readOnly: true
          ports:
            - containerPort: 80
              name: http
              hostPort: 80
            - containerPort: 443
              name: https
              hostPort: 443
          securityContext:
            allowPrivilegeEscalation: false
            readOnlyRootFilesystem: true
            runAsNonRoot: true
            runAsUser: 1000
            runAsGroup: 1000
            capabilities:
              drop:
                - ALL
              add:
                - NET_BIND_SERVICE
          resources:
            requests:
              cpu: 100m
              memory: 64Mi
      volumes:
        - name: haproxy
          configMap:
            name: haproxy
      nodeSelector:
        kubernetes.io/hostname: sophons-oduduwa
sops:
  age:
    - recipient: ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAII7yyj/sVuDdc6kGEeipVtC0EBaeACTFWHZ9MH77XsFq vrtx@kaos
      enc: |
        -----BEGIN AGE ENCRYPTED FILE-----
        YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IHNzaC1lZDI1NTE5IDNEQlRBdyBVVXo3
        TnBTRDFXdVZyUnVQK2tsMC80YVlMZ0FRaWdjOXRUS1UvajZKWW5NCnRxdHk1Q0la
        Z0RwV2kvdkdYQXRHckNza2NqRE5yNnptdVhWVDk0Vm5oeVEKLS0tIE9uenB1MzUy
        T0FpMC96QXJsVENQT0FaMi9NR2xVVnl3bHNpK3NQNm1iQzgKu8194BjGp7qlDFJl
        YbnPoU4cUHh1GjP1zLKtJsxKZoh80a+bE5FuWXMVtDmoc6CF7A4SFqywMq9B3yLU
        e5I0Pw==
        -----END AGE ENCRYPTED FILE-----
    - recipient: age1kum4z0unkunza7kxt4ma7v8k38ggvtjhx6wntnjt8clt6xpyu3eqsw435t
      enc: |
        -----BEGIN AGE ENCRYPTED FILE-----
        YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSB5U2NiaHJrS09CSVdmeVNj
        YVVwUWRMTHZPWVBTdEoyQjBhN1JVdlRFL0hzClhPNm14R3c5Ym1RRytGb2JjSEVQ
        NjhVTHBZWkRad3ZIdmVzVHgxUnE4ZzgKLS0tIGI4bk9QYVVla21teFB0WmlsUDEv
        Q1BmZ0dvbXhUdlgwNVJRQXFDbVMxeUEKjOClwtCDR73lvLoQBPr5DkaxQTKD/EUD
        xz8Bm1oO0sv/zaNe+FzNihoEmf7SzyPtdLWyFxrLHZ93fX3BI95xoA==
        -----END AGE ENCRYPTED FILE-----
  lastmodified: "2025-11-13T13:00:44Z"
  mac: ENC[AES256_GCM,data:gA+dmI9DrCks44PuAfWgQldJ70LWxM2mJuNYLTveUu0ZskpqVAuyw4JsAlg4UyAS4g4VjFdAk3A4vHchYVnbNBWWuDLO5Lf0NlvetT7Ltlz0QOVnVoQwWoDDDvJPGW+RbOAi7HnPTUTQb3mCaYVZ+TV+vuZmcXRC4jVrA4fbKM4=,iv:W2qlQhsA9aZxAZI4uZ9gZhfWLnlTbXqGraSptg/AUJQ=,tag:HnjGPVioij5AcUPUzud+lg==,type:str]
  encrypted_comment_regex: enc!
  version: 3.11.0

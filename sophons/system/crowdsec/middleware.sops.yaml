apiVersion: traefik.io/v1alpha1
kind: Middleware
metadata:
  name: crowdsec-bouncer
  namespace: crowdsec
spec:
  plugin:
    crowdsec-bouncer-traefik-plugin:
      enabled: true
      updateMaxFailure: -1
      httpTimeoutSeconds: 15
      crowdsecMode: stream
      crowdsecLapiScheme: https
      crowdsecLapiHost: crowdsec-service.crowdsec.svc.cluster.local:8080
      crowdsecLapiTlsInsecureVerify: true
      # enc!
      crowdsecLapiKey: ENC[AES256_GCM,data:KsQh3OVjTEQpVqeOgKhS/grQC2DgaKcIHosClIeVxR6KNywOjzMcVcqqjjb2UCh9cw0+vUqaJrBfqSET13XAJYegIQtpAFV+lPtFu+6oamvB8+7ZF0A6NrG50/AnF46nQhD1w0Jnlrb7cHDw3KvXaQjgYI0EAL/PrXcDYd34NBk=,iv:Mt/eg+qJ5e7PvHN7qm0u4rm3DdQj4X6VrLLg7id2UDE=,tag:EDET4efbpOXSNHbPIkQwLA==,type:str]
      forwardedHeadersTrustedIPs:
        # tailscale
        - 100.64.0.0/10
        - fd7a:115c:a1e0::/48
        # Cloudflare
        - 173.245.48.0/20
        - 103.21.244.0/22
        - 103.22.200.0/22
        - 103.31.4.0/22
        - 141.101.64.0/18
        - 108.162.192.0/18
        - 190.93.240.0/20
        - 188.114.96.0/20
        - 197.234.240.0/22
        - 198.41.128.0/17
        - 162.158.0.0/15
        - 104.16.0.0/13
        - 104.24.0.0/14
        - 172.64.0.0/13
        - 131.0.72.0/22
        - 2400:cb00::/32
        - 2606:4700::/32
        - 2803:f800::/32
        - 2405:b500::/32
        - 2405:8100::/32
        - 2a06:98c0::/29
        - 2c0f:f248::/32
sops:
  age:
    - recipient: ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAII7yyj/sVuDdc6kGEeipVtC0EBaeACTFWHZ9MH77XsFq vrtx@kaos
      enc: |
        -----BEGIN AGE ENCRYPTED FILE-----
        YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IHNzaC1lZDI1NTE5IDNEQlRBdyBZekFV
        T2NsVkgvMkZRVTUwcG1XYlF3Rlc4MVFmQ09yakZiK0hGNGtTcjM0Cm5RV2dVUzY1
        eDZxd3EzQUtmRzh2WXpRemtHSWNRVVByNGgyMjlkK2ZoSTQKLS0tIHBremowNGxU
        SmRsVDlrbWJOZVlRSXZSWEhEbzVPMldPTDVvWnZNYXZCTHMKvtubJL+DGUZ8Rofh
        SPl7dy7PZZynDvVfghLa3UrJJel9BDheGgq9JFupQobAIaRlmJ7iuYS5DQUKULph
        kQiXGg==
        -----END AGE ENCRYPTED FILE-----
    - recipient: age1kum4z0unkunza7kxt4ma7v8k38ggvtjhx6wntnjt8clt6xpyu3eqsw435t
      enc: |
        -----BEGIN AGE ENCRYPTED FILE-----
        YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSA3ZEhYSDQxUmNhTVUyZEh5
        dEdBM2VxRXZYU0RjWE01UTJjUy9mcE0xcjFZCkhYZnJTcWZxbEF1ZXNsUjZVdUhn
        RWhnZ2ppb25NdXcyK29NMkpuVURpanMKLS0tIGdlWGhRNXlxWVdVRk1YS0pUdnFn
        ZFkwWk5hRTduTVFVREwzY2lTWmxiNUkKciDLpmxpT2CItYr93d6Uc2cS+2jgcA5J
        Ze6yMzHG502eIRjVui8ZCA6fs9u/SFXl4isqJXuuYnDRbEVWlhTE9g==
        -----END AGE ENCRYPTED FILE-----
  lastmodified: "2025-12-01T19:53:22Z"
  mac: ENC[AES256_GCM,data:ybOfY8JSueS1gQ5MmUY/plNsu8ZSvBG6aSAusfDyAKfl9DIzzpimMOshwsTjGGyzlcOqn8gS9QcqMqO9nyKndhWiopMu7SyWvWScfxNgFRh3iRT1eG19lMeU0e02quHCAAyhKaMpgs+s4mfS4Q6yawOOFzYDA78oW/lUaWwDU8k=,iv:fPCPiU7AWk0tc7gO4xb+4CzS6xszaUWZMicJ1/3f+84=,tag:AtIV9ViltLWyQfjDyc7E2w==,type:str]
  encrypted_comment_regex: enc!
  version: 3.11.0
